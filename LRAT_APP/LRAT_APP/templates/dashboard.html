{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LRAT - Dashboard</title>
    <link rel="stylesheet" type="text/css" href="{% static 'CSS/styles.css' %}?v=2">
</head>
<body class="dashboard-page">

    <header>
        <nav class="header-nav">
            <div class="nav-left">
                <a href="{% url 'dashboard' %}" class="brand">LRAT</a>
                <span class="greeting">Welcome, {{ user.first_name }} {{ user.last_name }}!</span>
            </div>
            <div class="nav-right">
                
                <a href="{% url 'dashboard' %}">
                    <button type="button">Dashboard</button>
                </a>
                <a href="{% url 'software_list' %}">
                    <button type="button">All Software</button>
                </a>
                <a href="{% url 'logout' %}">
                    <button type="button" class="logout-button">Logout</button>
                </a>
            </div>
        </nav>
    </header>

    <main>
        <h2>My Subscriptions</h2>

        <div class="summary-container">
            <div class="summary-card">
                <span class="label">Total Subscriptions</span>
                <span class="value">{{ total_subscriptions }}</span>
            </div>

            <div class="summary-card">
                <span class="label">Total Active</span>
                <span class="value">{{ total_active }}</span>
            </div>

            <div class="summary-card">
                <span class="label">Total Expired</span>
                <span class="value">{{ total_expired }}</span>
            </div>

            <div class="summary-card">
                <span class="label">Total Cost for Active Subscriptions</span>
                <span class="value">${{ total_cost }}</span>
            </div>
        </div>

        <table>
            <tr>
                <th>
                    <a href="?sort={% if current_sort == 'software__subscription_name' %}-software__subscription_name{% else %}software__subscription_name{% endif %}">
                        {% if current_sort == 'software__subscription_name' %}
                            Software Name ▲
                        {% elif current_sort == '-software__subscription_name' %}
                            Software Name ▼
                        {% else %}
                            Software Name
                        {% endif %}
                    </a>
                </th>

                <th>
                    <a href="?sort={% if current_sort == 'date_subscribed' %}-date_subscribed{% else %}date_subscribed{% endif %}">
                        {% if current_sort == 'date_subscribed' %}
                            Start Date ▲
                        {% elif current_sort == '-date_subscribed' %}
                            Start Date ▼
                        {% else %}
                            Start Date
                        {% endif %}
                    </a>
                </th>

                <th>
                    <a href="?sort={% if current_sort == 'date_expired' %}-date_expired{% else %}date_expired{% endif %}">
                        {% if current_sort == 'date_expired' %}
                            End Date ▲
                        {% elif current_sort == '-date_expired' %}
                            End Date ▼
                        {% else %}
                            End Date
                        {% endif %}
                    </a>
                </th>

                <th>
                    <a href="?sort={% if current_sort == 'total_cost' %}-total_cost{% else %}total_cost{% endif %}">
                        {% if current_sort == 'total_cost' %}
                            Cost ▲
                        {% elif current_sort == '-total_cost' %}
                            Cost ▼
                        {% else %}
                            Cost
                        {% endif %}
                    </a>
                </th>

                <th>
                    <a href="?sort={% if current_sort == 'currently_used' %}-currently_used{% else %}currently_used{% endif %}">
                        {% if current_sort == 'currently_used' %}
                            Status ▲
                        {% elif current_sort == '-currently_used' %}
                            Status ▼
                        {% else %}
                            Status
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="?sort={% if current_sort == 'date_expired' %}-date_expired{% else %}date_expired{% endif %}">
                        {% if current_sort == 'date_expired' %}
                            Remaining ▲
                        {% elif current_sort == '-date_expired' %}
                            Remaining ▼
                        {% else %}
                            Remaining
                        {% endif %}
                    </a>
                </th>
            </tr>

            {% for sub in subscriptions %}
            <tr>
                <td>
                    <a href="{% url 'license_info' sub.software.software_id %}">
                        {{ sub.software.subscription_name }}
                    </a>
                </td>
                <td>{{ sub.date_subscribed|date:"m/d/Y"|default:"N/A" }}</td>
                <td>{{ sub.date_expired|date:"m/d/Y"|default:"N/A" }}</td>
                <td>${{ sub.total_cost }}</td>
                <td>
                    {% if sub.currently_used %}
                        Active
                    {% else %}
                        Expired
                    {% endif %}
                </td>
                <td>{{ sub.time_remaining_display }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">No subscriptions yet.</td>
            </tr>
            
            {% endfor %}
        </table>
    </main>

</body>
</html>